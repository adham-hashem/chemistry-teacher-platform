# CT Platform API

![.NET](https://img.shields.io/badge/.NET-9.0-blueviolet)
![License](https://img.shields.io/badge/license-MIT-green)
![Build Status](https://img.shields.io/badge/build-passing-brightgreen)

The **CT Platform API** is a secure, RESTful Web API built with **ASP.NET Core** for an educational platform. It enables teachers to create and manage courses, lessons, exams, and discount codes, while students can access learning materials, submit exam results, and manage subscriptions. The API supports **JWT-based authentication** and integrates with payment gateways via webhooks. It uses **Entity Framework Core** for data access and **SQL Server** for persistence, ensuring scalability and security. Identifiers use `Guid` for enhanced uniqueness and security.

## Table of Contents

- [Features](#features)
- [Technologies](#technologies)
- [Getting Started](#getting-started)
  - [Prerequisites](#prerequisites)
  - [Installation](#installation)
  - [Configuration](#configuration)
- [API Endpoints](#api-endpoints)
- [Security](#security)
- [Contributing](#contributing)
- [License](#license)

## Features

- **User Management**: Register, login, refresh tokens, reset passwords, and verify emails with JWT-based authentication.
- **Course Management**: Teachers can create, update, and delete courses with associated lessons and multimedia content.
- **Lesson Access**: Students access lessons via subscriptions or unique access codes generated by teachers.
- **Exam System**: Create, manage, and submit exams with automated scoring and result tracking.
- **Discount Codes**: Teachers can generate and manage discount codes for subscriptions.
- **Payment Integration**: Supports payment initiation and webhook callbacks for seamless transaction processing.
- **Role-Based Authorization**: Supports `Teacher` and `Student` roles with fine-grained access control.
- **File Uploads**: Handles multimedia uploads (e.g., lesson PDFs, course images) using multipart/form-data.

## Technologies

- **ASP.NET Core 8.0**: Framework for building the RESTful API.
- **Entity Framework Core**: ORM for database operations.
- **SQL Server**: Relational database for data storage.
- **JWT Authentication**: Secure token-based authentication.
- **CORS**: Configurable cross-origin resource sharing for trusted clients.

## Getting Started

### Prerequisites

- [.NET 8.0 SDK](https://dotnet.microsoft.com/download/dotnet/8.0)
- [SQL Server](https://www.microsoft.com/en-us/sql-server/sql-server-downloads)
- [Visual Studio 2022](https://visualstudio.microsoft.com/) or [VS Code](https://code.visualstudio.com/)
- [Postman](https://www.postman.com/) or similar for API testing

### Installation

1. **Clone the repository**:
   ```bash
   git clone https://github.com/your-username/ct-platform-api.git
   cd ct-platform-api
   ```

2. **Restore dependencies**:
   ```bash
   dotnet restore
   ```

3. **Set up the database**:
   - Update the connection string in `appsettings.json`:
     ```json
     {
       "ConnectionStrings": {
         "DefaultConnection": "Server=your-server;Database=CTPlatformDb;Trusted_Connection=True;TrustServerCertificate=True;"
       }
     }
     ```
   - Run migrations to create the database:
     ```bash
     dotnet ef migrations add InitialCreate
     dotnet ef database update
     ```

4. **Run the application**:
   ```bash
   dotnet run
   ```

5. **Access Swagger UI**:
   - Open `https://localhost:5001/swagger` (or your configured port) to explore and test the API.

## Configuration

### .env file
```bash
# Database Connection
CTPlatform_DEV_DATABASE=""

# Initial Teacher Login Cred
TEACHER_USERNAME=""
TEACHER_PASSWORD=""
TEACHER_EMAIL=""

# Initial Student Login Cred
STUDENT_USERNAME=""
STUDENT_PASSWORD=""
STUDENT_EMAIL=""

# JWT Authentication
CTP_DEV_JWT_SECRET=""
CTP_DEV_JWT_ISSUER=""
CTP_DEV_JWT_AUDIENCE=""
CTP_DEV_JWT_EXPIRATION_DAYS=

# Email Settings
SMTP_SERVER=""
SMTP_PORT_NUMBER=""
SMTP_SENDER_EMAIL=""
SMTP_APP_PASSWORD=""

# Paymob
PAYMOB_API_KEY=""
PAYMOB_CARD_INTEGRATION_ID=""
PAYMOB_CARD_IFRAME_ID=""
PAYMOB_WALLET_INTEGRATION_ID=""
PAYMOB_WALLET_IFRAME_ID=""
PAYMOB_HMAC=""

# Kashier
KASHIER_MERCHANT_ID=""
KASHIER_API_KEY=""
KASHIER_TEST_MODE=
KASHIER_MERCHANT_REDIRECT_URL=""
KASHIER_SERVER_WEBHOOK_URL=""

```

### CORS
Configure allowed origins in `Program.cs`:
```csharp
builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowSpecificOrigins", builder =>
    {
        builder.WithOrigins("https://trusted-client.com")
               .AllowAnyMethod()
               .AllowAnyHeader()
               .AllowCredentials();
    });
});
```

## API Endpoints
The API provides endpoints for managing users, courses, lessons, exams, subscriptions, and payments.

*Details coming soon.*

## Security
- **JWT Authentication**: Secures endpoints with token-based authentication, eliminating CSRF risks for non-cookie-based clients.
- **CORS**: Restricts requests to trusted origins.
- **HTTPS**: Enforces secure communication.
- **Guid Identifiers**: Uses `Guid` for unique identifiers (e.g., course, lesson, exam IDs, question indices) to enhance security.

## Contributing
Contributions are welcome! Please follow these steps:

1. Fork the repository.
2. Create a feature branch (`git checkout -b feature/your-feature`).
3. Commit your changes (`git commit -m "Add your feature"`).
4. Push to the branch (`git push origin feature/your-feature`).
5. Open a pull request.

## License
This project is licensed under the MIT License.